# 格式

## 缩进

- ctrl + { 往左缩进or }往右缩进
  - matlab
  - vscode

## 格式化

ctrl+shift+i

## 打开命令面板

ctrl+shift+p


# Debug 设置

[官网教程](https://code.visualstudio.com/docs/cpp/config-linux)

## 0. pkg-config

在`g++`命令中，`pkg-config`是一个用于检索已安装的软件包的工具。它通常与编译和链接过程一起使用，以帮助获取所需的编译选项和库路径。

使用`pkg-config`命令的常见语法如下：

```lua
pkg-config --cflags <package>    # 获取指定软件包的编译选项
pkg-config --libs <package>      # 获取指定软件包的库路径
```

## 1. tasks.json

用来预定义设置一些任务，让vscode去自动完成。

比如设置好后可以让vscode直接一键编译(ctrl+shift+b)：

下面实现：

1. 创建一个build目录`mkdir -p build`
2. 构建c++程序`g++ -std=c++11 task7_pinocchio.cpp -o task7_pinocchio $(pkg-config --cflags --libs pinocchio)`

```json
{
    "tasks": [
        // ***************** 执行mkdir -p build *****************
        {
           "type": "shell",		// 命令行任务类型，让vscode执行任意命令行命令
           "label": "mkdir_alias", 	// 命令的别名
           "command":"mkdir", 	// 执行mkdir
           "args":[				// 命令的参数
               "-p",
               "build"
           ],
        }，
        // ***************** 执行g++ -std=c++11 task7_pinocchio.cpp -o task7_pinocchio $(pkg-config --cflags --libs pinocchio) *****************
        {
            "type": "cppbuild",							// c++构建的任务类型，让vscode可以自动构建和编译c++项目
            "label": "C/C++: g++ build active file",	// 命令的别名
            "command": "/usr/bin/g++",					// 命令
            "args": [
                "-g",	// 使用-g选项进行编译后，才可以使用调试器（如GDB）来调试生成的可执行文件。-g选项用于生成调试信息。它告诉编译器在编译过程中将调试信息嵌入生成的可执行文件中，以便在调试阶段使用。
                "-std=c++11",
                "${file}",
                "-o",
                "${fileDirname}/${fileBasenameNoExtension}",
                "`pkg-config --cflags --libs pinocchio`"
            ],
            "options": {
                "cwd": "${fileDirname}"					// 该命令发挥作用的工作目录
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "detail": "Task generated by Debugger.",
    		"dependsOn":[								// 依赖于mkdir_alias任务，所以先执行上面那个任务
                "mkdir_alias"
            ]
        }
    ],
    "version": "2.0.0"
}
```

## 2. lanuch.json

这个是调试启动文件（launch configuration）

```json
{
    "version": "0.2.0",
    "configurations": [
      {
        "name": "C/C++: g++ build and debug active file",
        "type": "cppdbg",
        "request": "launch",
        "program": "${fileDirname}/${fileBasenameNoExtension}",
        "args": [],
        "stopAtEntry": false,
        "cwd": "${fileDirname}",//通常应该是${workspaceFolder}，但这里读不到urdf不知道为什么
        "environment": [],
        "externalConsole": false,
        "MIMode": "gdb",	//使用gdb调试器
        "miDebuggerPath": "/usr/bin/gdb",
        "setupCommands": [
          {
            "description": "Enable pretty-printing for gdb",
            "text": "-enable-pretty-printing",
            "ignoreFailures": true
          }
        ],
        "preLaunchTask": "C/C++: g++ build active file"
      }
    ]
  }
```

## 3. c_cpp_properties.json

用于指定代码路径。

`ctrl+shift+p`打开控制面板，输入`c/c++: edit configurations(JSON)`

```json
{
  "configurations": [
    {
      "browse": {
        "databaseFilename": "${default}",
        "limitSymbolsToIncludedHeaders": false
      },
      "includePath": [
        "/home/yang/Desktop/SLAM_Code_Learning/lsd_ws/devel/include/**",
        "/opt/ros/noetic/include/**",
        "/usr/include/**",
        "/home/yang/Desktop/SLAM_Code_Learning/lsd_ws/src/lsd_slam/lsd_slam_core/src/**",
        "/home/yang/Desktop/SLAM_Code_Learning/lsd_ws/src/lsd_slam/lsd_slam_viewer/src/**"
      ],
      "name": "ROS",
      "intelliSenseMode": "gcc-x64",
      "compilerPath": "/usr/bin/gcc",
      "cStandard": "gnu11",
      "cppStandard": "c++14"
    }
  ],
  "version": 4
}
```

# ROS Debug

以[lsd_slam](https://github.com/Fernweh-yang/SLAM_Code_Learning/tree/main/lsd_ws/src/lsd_slam)为例

## 1. 文件目录

主要有2个包`lsd_slam_core`和`lsd_slam_viewer`

```
lsd
├── lsd_slam
├── lsd_slam_core
│   ├── calib
│   ├── cfg
│   ├── cmake
│   ├── launch
│   ├── src
│   │   ├── DataStructures
│   │   ├── DepthEstimation
│   │   ├── GlobalMapping
│   │   ├── IOWrapper
│   │   │   ├── OpenCV
│   │   │   └── ROS
│   │   ├── Tracking
│   │   └── util
│   └── thirdparty
│       ├── openFabMap
│       └── Sophus
└── lsd_slam_viewer

```

## 2. 正常启动

1. `roscore`

2. 先启动viewer的node

   ```c++
   rosrun lsd_slam_viewer viewer
   ```

3. 再启动core的node

   ```
   rosrun lsd_slam_core dataset _files:=/home/yang/Downloads/LSD_room_images/LSD_room/images _hz:=1 _calib:=/home/yang/Downloads/LSD_room_images/LSD_room/cameraCalibration.cfg
   ```

## 3. 单个node调试

1. vscode中下载ros插件

2. 在debug页面中

   1. create a launch.json file
   2. 选择ROS
   3. 选择ROS:Attach，创建得到launch.json（不需要修改）

3. 在终端中根据2.正常启动所有的节点

4. 在要调试的ros节点代码中设置好断点

5. 在vscode的debug页面中启动刚刚创建的launch.json

   1. 根据要调试的代码，选择c++/python

   2. 选择要调试的ros节点进程

      比如我要调试core的node: dataset，就选dataset

## 4. 多个node调试

1. vscode中下载ros插件

2. 在debug页面中

   1. create a launch.json file
   2. 选择ROS
   3. 选择ROS:Launch，创建得到launch.json（需要修改）

   ```json
   {
       "version": "0.2.0",
       "configurations": [
           {
               "name": "ROS: Launch",
               "type": "ros",
               "request": "launch",
               /************
               这个target需要设置为要调试的launch文件的绝对路径
               ************/
               "target": "/home/yang/Desktop/SLAM_Code_Learning/lsd_ws/src/lsd_slam/lsd_slam_core/launch/xx.launch"
           },        
           {
               "name": "ROS: Attach",
               "request": "attach",
               "type": "ros"
           }
       ]
   }
   ```

3. 在终端中`ros launch xx`启动所有的节点

4. 在要调试的ros节点代码中设置好断点

5. 在vscode的debug页面中启动刚刚创建的launch.json

   1. 根据要调试的代码，选择c++/python

   2. 选择要调试的ros节点进程

      比如我要调试core的node: dataset，就选dataset

# 连接SSH

1. vscode安装remote-ssh插件

2. 生成本机密钥并复制公钥

   ```
   ssh-keygen -t rsa -C "youremail@example.com" 
   xclip -sel clip < ~/.ssh/id_rsa.pub
   ```

3. 在远程服务器的~/.ssh文件夹中创建`authorized_keys` 文件

   ```
   touch ~/.ssh/authorized_keys
   chmod 600 ~/.ssh/authorized_keys
   ```

4. 将第二步复制的公钥保存到authorized_keys中去(一行一个公钥)

5. 配置vscode的config

   - 点击左侧小图标：remote explorer的小齿轮打开第一个config文件`~/.ssh/config`

   - 填入如下配置

     如果有3个服务器可以连：

     ```
     # Read more about SSH config files: https://linux.die.net/man/5/ssh_config
     Host server1
         HostName 100.10.160.81
         User yang.xu
         IdentityFile ~/.ssh/id_rsa
     
     Host server2
         HostName 100.10.160.82
         User yang.xu
         IdentityFile ~/.ssh/id_rsa
     
     Host server3
         HostName 100.10.160.83
         User yang.xu
         IdentityFile ~/.ssh/id_rsa
     ```

     - Host ：连接的主机名称，可自定义;
     - Hostname ：远程主机的 IP 地址;
     - User ：用于登录远程主机的用户名;
     - Port ：用于登录远程主机的端口，SSH 默认为 22 ;
     - IdentityFile ：本地的私钥文件 id_rsa 路径;

6. 重启vscode后，就可以在左侧小图标：remote explorer页面中看到服务器了。选择一个服务器连接

# Plugins

## 1. Codewhisperer

亚马逊出的编程[AI助手](https://aws.amazon.com/codewhisperer/resources/?nc1=h_ls)

### 下载

VSCODE中搜索AWS Toolkit下载后登录账号就可使用

### 使用

- 写好注释后，通常会自动触发生成代码建议，如果没触发按`alt+c`手动触发
  - 按`tab`接受代码建议
  - 按`esc`不接受
  - 按$ctrl+左右键$单独接受

